<!DOCTYPE html>
<html lang="en" dir="auto">

<head><meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
<meta name="robots" content="noindex, nofollow">
<title>Slacknet | evanslack.dev</title>
<meta name="keywords" content="k3s, docker, homelab">
<meta name="description" content="Homelab with kubernetes, virtual machines, containers and more">
<meta name="author" content="">
<link rel="canonical" href="https://evanslack.dev/slacknet">
<link crossorigin="anonymous" href="/assets/css/stylesheet.bc1149f4a72aa4858d3a9f71462f75e5884ffe8073ea9d6d5761d5663d651e20.css" integrity="sha256-vBFJ9KcqpIWNOp9xRi915YhP/oBz6p1tV2HVZj1lHiA=" rel="preload stylesheet" as="style">
<script defer crossorigin="anonymous" src="/assets/js/highlight.f413e19d0714851f6474e7ee9632408e58ac146fbdbe62747134bea2fa3415e0.js" integrity="sha256-9BPhnQcUhR9kdOfuljJAjlisFG&#43;9vmJ0cTS&#43;ovo0FeA="
    onload="hljs.initHighlightingOnLoad();"></script>
<link rel="icon" href="https://evanslack.dev/favicon.ico">
<link rel="icon" type="image/png" sizes="16x16" href="https://evanslack.dev/favicon-16x16.png">
<link rel="icon" type="image/png" sizes="32x32" href="https://evanslack.dev/favicon-32x32.png">
<link rel="apple-touch-icon" href="https://evanslack.dev/apple-touch-icon.png">
<link rel="mask-icon" href="https://evanslack.dev/safari-pinned-tab.svg">
<meta name="theme-color" content="#2e2e33">
<meta name="msapplication-TileColor" content="#2e2e33">
<noscript>
    <style>
        #theme-toggle,
        .top-link {
            display: none;
        }

    </style>
</noscript>
</head>

<body class=" dark" id="top">
<script>
    if (localStorage.getItem("pref-theme") === "light") {
        document.body.classList.remove('dark')
    }

</script>

<header class="header">
    <nav class="nav">
        <div class="logo">
            <a href="https://evanslack.dev/" accesskey="h" title="evanslack.dev (Alt + H)">evanslack.dev</a>
            <div class="logo-switches">
                <button id="theme-toggle" accesskey="t" title="(Alt + T)">
                    <svg id="moon" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"></path>
                    </svg>
                    <svg id="sun" xmlns="http://www.w3.org/2000/svg" width="24" height="18" viewBox="0 0 24 24"
                        fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round"
                        stroke-linejoin="round">
                        <circle cx="12" cy="12" r="5"></circle>
                        <line x1="12" y1="1" x2="12" y2="3"></line>
                        <line x1="12" y1="21" x2="12" y2="23"></line>
                        <line x1="4.22" y1="4.22" x2="5.64" y2="5.64"></line>
                        <line x1="18.36" y1="18.36" x2="19.78" y2="19.78"></line>
                        <line x1="1" y1="12" x2="3" y2="12"></line>
                        <line x1="21" y1="12" x2="23" y2="12"></line>
                        <line x1="4.22" y1="19.78" x2="5.64" y2="18.36"></line>
                        <line x1="18.36" y1="5.64" x2="19.78" y2="4.22"></line>
                    </svg>
                </button>
            </div>
        </div>
        <ul id="menu">
            <li>
                <a href="https://evanslack.dev/" title="home">
                    <span>home</span>
                </a>
            </li>
            <li>
                <a href="https://evanslack.dev/about/" title="about">
                    <span>about</span>
                </a>
            </li>
            <li>
                <a href="https://evanslack.dev/projects/" title="projects">
                    <span>projects</span>
                </a>
            </li>
        </ul>
    </nav>
</header>
<main class="main">

<article class="post-single">
  <header class="post-header">
    <div class="breadcrumbs"><a href="https://evanslack.dev/">Home</a>&nbsp;»&nbsp;<a href="https://evanslack.dev/projects/">Projects</a></div>
    <h1 class="post-title">
      Slacknet
    </h1>
    <div class="post-meta">

</div>
  </header> 
  <div class="post-content"><p><a href="https://github.com/evanofslack/slacknet">github</a></p>
<h2 id="about">About<a hidden class="anchor" aria-hidden="true" href="#about">#</a></h2>
<p>I manage a few physical machines and self-host many services in my homelab. What started as a single raspberry pi running a few docker containers has grown to multiple servers in a highly available proxmox cluster running network storage, LXCs, and a k3s cluster. I also have a pair of raspberry pis running redundant DNS and adblock services.</p>
<h2 id="hardware">Hardware<a hidden class="anchor" aria-hidden="true" href="#hardware">#</a></h2>
<p>I currently run 3 main servers in my lab: a host node with lots of memory for multiple master and worker VMs, a storage node with ZFS-backed network store, and a workstation with powerful CPU and GPU for compute intensive tasks.</p>
<p><strong>Host Node</strong></p>
<ul>
<li>AMD Ryzen 5600X (6 cores, 12 threads)</li>
<li>128Gb DDR4 3200mHz RAM</li>
<li>1Tb NVME SSD</li>
<li>Proxmox VME</li>
</ul>
<p><em>This server runs ~10 virtual machines, most of which are k3s nodes.</em></p>
<p><strong>Storage Node</strong></p>
<ul>
<li>Intel core i5 10400 (6 cores, 12 threads) w/ quicksync iGPU</li>
<li>128Gb DDR4 3200mHz RAM</li>
<li>2Tb NVME SSD</li>
<li>2x 14Tb drives in ZFS mirror</li>
<li>Proxmox VME</li>
</ul>
<p><em>This machine is primarily a NAS and file server, but also runs an LXC for my VPN (Tailscale) as well as multiple docker containers for redundant services.</em></p>
<p><strong>Workstation</strong></p>
<ul>
<li>Intel core i7 12700kf (12 cores, 20 threads)</li>
<li>32 Gb DDR4 3600mHz RAM</li>
<li>Nvidia 3080 GPU (12Gb VRAM)</li>
<li>2Tb NVME SSD</li>
<li>Windows 11 w/ WSL (Ubuntu)</li>
</ul>
<p><em>This machine is my primary development station and also hosts services that require GPU compute.</em></p>
<h2 id="k3s">k3s<a hidden class="anchor" aria-hidden="true" href="#k3s">#</a></h2>
<p>My favorite part of the lab is my kubernetes cluster. As I am hosting on bare metal, I decided to go with k3s, a lightweight kubernetes implementation. The highly available cluster runs across 9 virtual machines, with 3 master nodes, 3 worker nodes, and 3 storage nodes dedicated to longhorn storage.</p>
<p>I have aimed to make setup and tear down of all infrastructure as automated as possible. I have bash scripts to create Ubuntu CloudInit templates, use Terraform to provision the virtual machines on Proxmox, and then use Ansible playbooks to install k3s on the nodes.</p>
<p>The entire cluster is managed declaratively with Gitops, relying on Flux to sync all state between the cluster and github repository. This makes it incredibly easy redeploy the entire cluster when necessary and also track changes from a single source of truth.</p>
<p>Most of the services I run are either Helm charts or collections of kustomize manifests. Here is a non-comprehensive and likely outdated list of services and applications I run:</p>
<p><strong>System</strong></p>
<ul>
<li><a href="https://toolkit.fluxcd.io/">flux</a></li>
<li><a href="https://kube-vip.io/">kube-vip</a></li>
<li><a href="https://github.com/emberstack/kubernetes-reflector">reflector</a></li>
<li><a href="https://github.com/stakater/Reloader">reloader</a></li>
<li><a href="https://github.com/kubernetes-sigs/descheduler">descheduler</a></li>
<li><a href="https://github.com/weaveworks/kured">kured</a></li>
</ul>
<p><strong>Networking</strong></p>
<ul>
<li><a href="https://www.tigera.io/project-calico/">calico</a></li>
<li><a href="https://metallb.universe.tf/">metallb</a></li>
<li><a href="https://github.com/kubernetes-sigs/external-dns">external-dns</a></li>
<li><a href="https://github.com/ori-edge/k8s_gateway">k8s_gateway</a></li>
<li><a href="https://kubernetes.github.io/ingress-nginx/">ingress-nginx</a></li>
<li><a href="https://cert-manager.io/">cert-manager</a></li>
</ul>
<p><strong>Monitoring</strong></p>
<ul>
<li><a href="https://prometheus-operator.dev/">prometheus</a></li>
<li><a href="https://github.com/grafana/grafana">grafana</a></li>
<li><a href="https://github.com/grafana/loki">loki</a></li>
<li><a href="https://github.com/FairwindsOps/goldilocks">goldilocks</a></li>
<li><a href="https://github.com/louislam/uptime-kuma">uptime-kuma</a></li>
</ul>
<p><strong>Storage</strong></p>
<ul>
<li><a href="https://github.com/rancher/local-path-provisioner">local-path-provisioner</a></li>
<li><a href="https://github.com/longhorn/longhorn">longhorn</a></li>
</ul>
<p><strong>Database</strong></p>
<ul>
<li><a href="https://github.com/cloudnative-pg/cloudnative-pg">Cloudnative-Postgres-Operator</a></li>
<li><a href="https://github.com/mongodb/mongodb-kubernetes-operator">MongoDB-Kubernetes-Operator</a></li>
</ul>
<p><strong>Development</strong></p>
<ul>
<li><a href="https://github.com/go-gitea/gitea">Gitea</a></li>
<li><a href="https://github.com/mujx/hakatime">Hakatime</a></li>
<li><a href="https://github.com/muety/wakapi">Wakapi</a></li>
</ul>
<p><strong>Home Automation</strong></p>
<ul>
<li><a href="https://github.com/eclipse/mosquitto">Mosquitto</a></li>
<li><a href="https://github.com/emqx/emqx">EMQX</a></li>
<li><a href="https://github.com/home-assistant">Home-Assistant</a></li>
</ul>
<p>In addition to open source applications, I also use my cluster to deploy apps that I am actively developing. It has served as a great learning experience to understand how to write cloud native applications with microservice patterns, distributed state, and liveliness and readiness probes.</p>


  </div>

  <footer class="post-footer">
    <ul class="post-tags">
      <li><a href="https://evanslack.dev/tags/k3s/">k3s</a></li>
      <li><a href="https://evanslack.dev/tags/docker/">Docker</a></li>
      <li><a href="https://evanslack.dev/tags/homelab/">homelab</a></li>
    </ul>
<nav class="paginav">
  <a class="prev" href="https://evanslack.dev/projects/samila/">
    <span class="title">« Prev</span>
    <br>
    <span>Samila</span>
  </a>
</nav>

  </footer>
</article>
    </main>
    
<footer class="footer">
    <span>&copy; 2022 <a href="https://evanslack.dev/">evanslack.dev</a></span>
    <span>
        Powered by
        <a href="https://gohugo.io/" rel="noopener noreferrer" target="_blank">Hugo</a> &
        <a href="https://github.com/adityatelange/hugo-PaperMod/" rel="noopener" target="_blank">PaperMod</a>
    </span>
</footer>
<a href="#top" aria-label="go to top" title="Go to Top (Alt + G)" class="top-link" id="top-link" accesskey="g">
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 12 6" fill="currentColor">
        <path d="M12 6H0l6-6z" />
    </svg>
</a>

<script>
    let menu = document.getElementById('menu')
    if (menu) {
        menu.scrollLeft = localStorage.getItem("menu-scroll-position");
        menu.onscroll = function () {
            localStorage.setItem("menu-scroll-position", menu.scrollLeft);
        }
    }

    document.querySelectorAll('a[href^="#"]').forEach(anchor => {
        anchor.addEventListener("click", function (e) {
            e.preventDefault();
            var id = this.getAttribute("href").substr(1);
            if (!window.matchMedia('(prefers-reduced-motion: reduce)').matches) {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView({
                    behavior: "smooth"
                });
            } else {
                document.querySelector(`[id='${decodeURIComponent(id)}']`).scrollIntoView();
            }
            if (id === "top") {
                history.replaceState(null, null, " ");
            } else {
                history.pushState(null, null, `#${id}`);
            }
        });
    });

</script>
<script>
    var mybutton = document.getElementById("top-link");
    window.onscroll = function () {
        if (document.body.scrollTop > 800 || document.documentElement.scrollTop > 800) {
            mybutton.style.visibility = "visible";
            mybutton.style.opacity = "1";
        } else {
            mybutton.style.visibility = "hidden";
            mybutton.style.opacity = "0";
        }
    };

</script>
<script>
    document.getElementById("theme-toggle").addEventListener("click", () => {
        if (document.body.className.includes("dark")) {
            document.body.classList.remove('dark');
            localStorage.setItem("pref-theme", 'light');
        } else {
            document.body.classList.add('dark');
            localStorage.setItem("pref-theme", 'dark');
        }
    })

</script>
</body>

</html>
